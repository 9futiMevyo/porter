version: v2beta1

builds:
- name: porter
  method: docker
  dockerfile: ./docker/Dockerfile

apps:
- name: porter-dashboard
  depends_on:
    - postgres
  helm_chart:
    name: web
  build_ref: porter
  helm_values:
    container:
      command: /porter/migrate && /porter/app
    resources:
      requests:
        cpu: 400m
        memory: 512Mi

addons:
- name: postgres
  helm_chart:
    name: postgresql
    url: https://charts.bitnami.com/bitnami
  helm_values:
    global:
      auth:
        username: porter
        database: porter
